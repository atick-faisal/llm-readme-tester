name: ğŸš€ CI Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  lint:
    name: ğŸ” Lint README Tester
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ“¦ Install uv
        uses: astral-sh/setup-uv@v6
        with:
          python-version: "3.13"

      - name: ğŸ“¥ Install Dev Dependencies
        run: uv sync --all-extras --dev

      - name: ğŸ§ Run Ruff Linter (on action code only)
        run: ruff check

  test:
    name: ğŸ§ª Run All Tests
    needs: lint
    runs-on: ubuntu-latest
    env:
      GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}

    steps:
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ“¦ Install uv
        uses: astral-sh/setup-uv@v6
        with:
          python-version: "3.13"

      - name: ğŸ“¥ Install Runtime Dependencies
        run: uv sync

      - name: ğŸ§ª Run Pytest Suite
        run: uv run pytest

  readme:
    name: ğŸ“„ README Quality Check
    needs: lint
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v4

      - uses: ./
        with:
          google_api_key: ${{ secrets.GOOGLE_API_KEY }}
          checks: 'all'
